I"1|<p>“An object that contains a symbol, name or key that represents a list of commands, actions or keystrokes”. This is the definition of macto. one that should be familiar to any computer user. From this idea the Command design pattern was given birth.</p>

<p>The Macro represents a command that is built from the reunion of a set of other commands, in agiven order. Just as a macro, the command design pattern encapsulates commands(method calls) in objects allowing us to issue request without knowing the requested operation or the requesting object. Command design pattern provides the operations to queue commands,undo/redo actions and other manipulations.</p>

<h2 id="intent">Intent</h2>

<ul>
  <li>
    <p>encapsulate a request in an object.</p>
  </li>
  <li>
    <p>allow the parameterization of clients with different requests.</p>
  </li>
  <li>
    <p>allows saving the requests in a queue.</p>
  </li>
</ul>

<h2 id="implementation">Implementation</h2>

<p>The idea and implementation of the Command design pattern is quite simple, as we will see in the diagram below, needing only few extra classes implemented.</p>

<p><img src="/pictures/pattern/command_implementation_-_uml_class_diagram.gif" alt="command_implementation" /></p>

<p>The classes participating in the pattern:</p>

<p><strong>Command</strong> - declares an interface for executing an operation.</p>

<p><strong>ConcreteCommand</strong> - extends the Command interface, implementing the Execute method by invoking the corresponding operations on Receiver. It defines a link between the Receiver and the action.</p>

<p><strong>Client</strong> - create a ConcreteCommadn object and set its receiver.</p>

<p><strong>Invoker</strong> - asks the command to carry out the request.</p>

<p><strong>Receiver</strong> - knows how to perform the operations.</p>

<p>The Client asks for a command to be executed. The Invoker takes the command, encapsulates it and places it in a queue, in case there is something else to do first, and the ConcreteCommand that is in charge of the requested command, sending its result to the Receiver.</p>

<p>Here is a simple code of a classic implementation of this pattern for placing orders for buying and selling stocks:</p>

<p><img src="/pictures/pattern/command_example_stocks_-_uml_class_diagram_s.gif" alt="command_example_stocks" /></p>

<p>The client creates some orders for buying and selling stocks(ConcreteCommands). Then the orders are sent to the agent(Invoker). The agent takes the orders and place them to the StockTrade sysetm(Receiver). The agent keeps an internal queue with the order to be placed. Let’s assume that the StockTrade system is closed each Monday, but the agent accepts orders and queue them to be processed later on.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Order</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">execute</span> <span class="o">();</span>
<span class="o">}</span>

<span class="c1">// Receiver class.</span>
<span class="kd">class</span> <span class="nc">StockTrade</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">buy</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"You want to buy stocks"</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">sell</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"You want to sell stocks "</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// Invoker.</span>
<span class="kd">class</span> <span class="nc">Agent</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">Deque</span> <span class="n">ordersQueue</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArraryDeque</span><span class="o">();</span>

    <span class="kd">public</span> <span class="nf">Agent</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>
    <span class="kt">void</span> <span class="nf">placeOrder</span><span class="o">(</span><span class="nc">Order</span> <span class="n">order</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">ordersQueue</span><span class="o">.</span><span class="na">addLast</span><span class="o">(</span><span class="n">order</span><span class="o">);</span>
        <span class="n">order</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">ordersQueue</span><span class="o">.</span><span class="na">getFirstAndRemove</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">//ConcreteCommand Class.</span>
<span class="kd">class</span> <span class="nc">BuyStockOrder</span> <span class="kd">implements</span> <span class="nc">Order</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">StockTrade</span> <span class="n">stock</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">BuyStockOrder</span> <span class="o">(</span> <span class="nc">StockTrade</span> <span class="n">st</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">stock</span> <span class="o">=</span> <span class="n">st</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">execute</span><span class="o">(</span> <span class="o">)</span> <span class="o">{</span>
        <span class="n">stock</span> <span class="o">.</span> <span class="n">buy</span><span class="o">(</span> <span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">//ConcreteCommand Class.</span>
<span class="kd">class</span> <span class="nc">SellStockOrder</span> <span class="kd">implements</span> <span class="nc">Order</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">StockTrade</span> <span class="n">stock</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">SellStockOrder</span> <span class="o">(</span> <span class="nc">StockTrade</span> <span class="n">st</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">stock</span> <span class="o">=</span> <span class="n">st</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">execute</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">stock</span><span class="o">.</span><span class="na">sell</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// Client</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Client</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">StockTrade</span> <span class="n">stock</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StockTrade</span><span class="o">();</span>
        <span class="nc">BuyStockOrder</span> <span class="n">bsc</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BuyStockOrder</span> <span class="o">(</span><span class="n">stock</span><span class="o">);</span>
        <span class="nc">SellStockOrder</span> <span class="n">ssc</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SellStockOrder</span> <span class="o">(</span><span class="n">stock</span><span class="o">);</span>
        <span class="nc">Agent</span> <span class="n">agent</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Agent</span><span class="o">();</span>

        <span class="n">agent</span><span class="o">.</span><span class="na">placeOrder</span><span class="o">(</span><span class="n">bsc</span><span class="o">);</span> <span class="c1">// Buy Shares</span>
        <span class="n">agent</span><span class="o">.</span><span class="na">placeOrder</span><span class="o">(</span><span class="n">ssc</span><span class="o">);</span> <span class="c1">// Sell Shares</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="applicability--examples">Applicability &amp; Examples</h2>

<p>The applicability of Command design pattern can be found in these cases below</p>

<ul>
  <li>
    <p>parameterizes objects depending on the action they must perform.</p>
  </li>
  <li>
    <p>specifies or adds in a queue and execute requests at different moments in time.</p>
  </li>
  <li>
    <p>offers support for undoable actions (the execute method can memorize the state and allow going back to that state).</p>
  </li>
  <li>
    <p>structures the system in high level operations that based on primitive operations.</p>
  </li>
  <li>
    <p>decouple the object that invokes the action from the object that perform the action. Due to this usage it is also known as Producer Consumer design pattern.</p>
  </li>
</ul>

<p>For exampel we build a AudioPlayer System for little girl Julia.</p>

<p>Julia has a cassette player which has three buttons Play, Rewind, Stop.
In this example the keybord of the player is the Invoker, Julia is the Client,the player is Receiver.</p>

<p>There are three commands in this example PlayCommand,RewindCommand,StopCommand. Juila don’t need to know how these actions executed. She just press down the button then keybord recognize which button is preesed and ask the player to execute that command.</p>

<p>cassette player is a typically command pattern. it decouple Julia and the cassette player.</p>

<p><img src="/pictures/pattern/cassette_player.webp" alt="cassette player" /></p>

<h3 id="example-code">Example Code</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Receiver AudioPlayer</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AudioPlayer</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">play</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"play..."</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">rewind</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"rewind..."</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">stop</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"stop..."</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// Command</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Command</span> <span class="o">{</span>
    <span class="cm">/**
     * execute method
     */</span>
    <span class="kt">void</span> <span class="nf">execute</span><span class="o">();</span>
<span class="o">}</span>

<span class="c1">// Concrete Command</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PlayCommand</span> <span class="kd">implements</span> <span class="nc">Command</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">AudioPlayer</span> <span class="n">audio</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">PlayCommand</span><span class="o">(</span><span class="nc">AudioPlayer</span> <span class="n">audio</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">audio</span> <span class="o">=</span> <span class="n">audio</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">execute</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">audio</span><span class="o">.</span><span class="na">play</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RewindCommand</span> <span class="kd">implements</span> <span class="nc">Command</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">AudioPlayer</span> <span class="n">audio</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">RewindCommand</span><span class="o">(</span><span class="nc">AudioPlayer</span> <span class="n">audio</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">audio</span> <span class="o">=</span> <span class="n">audio</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">execute</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">audio</span><span class="o">.</span><span class="na">rewind</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">StopCommand</span> <span class="kd">implements</span> <span class="nc">Command</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">AudioPlayer</span> <span class="n">audio</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">StopCommand</span><span class="o">(</span><span class="nc">AudioPlayer</span> <span class="n">audio</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">audio</span> <span class="o">=</span> <span class="n">audio</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">execute</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">audio</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// Invoker Keyboard</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Keypad</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">Command</span> <span class="n">playCommand</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">Command</span> <span class="n">rewindCommand</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">Command</span> <span class="n">stopCommand</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setPlayCommand</span><span class="o">(</span><span class="nc">Command</span> <span class="n">playCommand</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">playCommand</span> <span class="o">=</span> <span class="n">playCommand</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setRewindCommand</span><span class="o">(</span><span class="nc">Command</span> <span class="n">rewindCommand</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">rewindCommand</span> <span class="o">=</span> <span class="n">rewindCommand</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setStopCommand</span><span class="o">(</span><span class="nc">Command</span> <span class="n">stopCommand</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">stopCommand</span> <span class="o">=</span> <span class="n">stopCommand</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">play</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">playCommand</span><span class="o">.</span><span class="na">execute</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">rewind</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">rewindCommand</span><span class="o">.</span><span class="na">execute</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">stop</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">stopCommand</span><span class="o">.</span><span class="na">execute</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// Client Julia</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Julia</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">//create the receiver</span>
        <span class="nc">AudioPlayer</span> <span class="n">audioPlayer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">AudioPlayer</span><span class="o">();</span>
        <span class="c1">//commands</span>
        <span class="nc">Command</span> <span class="n">playCommand</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PlayCommand</span><span class="o">(</span><span class="n">audioPlayer</span><span class="o">);</span>
        <span class="nc">Command</span> <span class="n">rewindCommand</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">RewindCommand</span><span class="o">(</span><span class="n">audioPlayer</span><span class="o">);</span>
        <span class="nc">Command</span> <span class="n">stopCommand</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StopCommand</span><span class="o">(</span><span class="n">audioPlayer</span><span class="o">);</span>
        <span class="c1">//invoker</span>
        <span class="nc">Keypad</span> <span class="n">keypad</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Keypad</span><span class="o">();</span>
        <span class="n">keypad</span><span class="o">.</span><span class="na">setPlayCommand</span><span class="o">(</span><span class="n">playCommand</span><span class="o">);</span>
        <span class="n">keypad</span><span class="o">.</span><span class="na">setRewindCommand</span><span class="o">(</span><span class="n">rewindCommand</span><span class="o">);</span>
        <span class="n">keypad</span><span class="o">.</span><span class="na">setStopCommand</span><span class="o">(</span><span class="n">stopCommand</span><span class="o">);</span>
        <span class="c1">//test</span>
        <span class="n">keypad</span><span class="o">.</span><span class="na">play</span><span class="o">();</span>
        <span class="n">keypad</span><span class="o">.</span><span class="na">rewind</span><span class="o">();</span>
        <span class="n">keypad</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
        <span class="n">keypad</span><span class="o">.</span><span class="na">play</span><span class="o">();</span>
        <span class="n">keypad</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="macro-command">Macro Command</h3>

<p>Suppose the audioPlayer has a record feature, it can remember commands have been executed then can execute these commands when the macro button is pressed.</p>

<p><img src="/pictures/pattern/macro_command.webp" alt="macro" /></p>

<h3 id="code">Code</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">MacroCommand</span> <span class="kd">extends</span> <span class="nc">Command</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="nc">Command</span> <span class="n">command</span><span class="o">);</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">remove</span><span class="o">(</span><span class="nc">Command</span> <span class="n">command</span><span class="o">);</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MacroAudioCommand</span> <span class="kd">implements</span> <span class="nc">MacroCommand</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Command</span><span class="o">&gt;</span> <span class="n">commandList</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">execute</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"---macro command start---"</span><span class="o">);</span>
        <span class="k">for</span> <span class="o">(</span><span class="nc">Command</span> <span class="n">command</span> <span class="o">:</span> <span class="n">commandList</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">command</span><span class="o">.</span><span class="na">execute</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"---done---"</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="nc">Command</span> <span class="n">command</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">commandList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">command</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">remove</span><span class="o">(</span><span class="nc">Command</span> <span class="n">command</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">commandList</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">command</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Julia</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">AudioPlayer</span> <span class="n">audioPlayer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">AudioPlayer</span><span class="o">();</span>
        <span class="nc">Command</span> <span class="n">playCommand</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PlayCommand</span><span class="o">(</span><span class="n">audioPlayer</span><span class="o">);</span>
        <span class="nc">Command</span> <span class="n">rewindCommand</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">RewindCommand</span><span class="o">(</span><span class="n">audioPlayer</span><span class="o">);</span>
        <span class="nc">Command</span> <span class="n">stopCommand</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StopCommand</span><span class="o">(</span><span class="n">audioPlayer</span><span class="o">);</span>
        <span class="nc">MacroCommand</span> <span class="n">macroCommand</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MacroAudioCommand</span><span class="o">();</span>
        <span class="n">macroCommand</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">playCommand</span><span class="o">);</span>
        <span class="n">macroCommand</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">rewindCommand</span><span class="o">);</span>
        <span class="n">macroCommand</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">stopCommand</span><span class="o">);</span>
        <span class="n">macroCommand</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">playCommand</span><span class="o">);</span>
        <span class="n">macroCommand</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">stopCommand</span><span class="o">);</span>
        <span class="n">macroCommand</span><span class="o">.</span><span class="na">execute</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="sepcific-problems-and-implementation">Sepcific problems and implementation</h2>

<p>Now that we have understood how the pattern works, it’s time to take a look at its advantages and flaws, too.</p>

<h3 id="the-intelligence-of-a-command">The intelligence of a command</h3>

<p>There are two extremes that a programer must avoid when using this pattern:</p>

<ol>
  <li>
    <p>The command is just a link between the receiver and the actions that carry out the request.</p>
  </li>
  <li>
    <p>The command implementations everything itself, without sending anything to the receiver.</p>
  </li>
</ol>

<p>We must always keep in mind the fact that the receiver if one who knows how to perform the operations needed, the purpose of the command being to help the client to delegate its request quickly and to make sure the command ends up where it should.</p>

<h3 id="undo-and-redo-actions">Undo and redo actions</h3>

<p>As mentioned above, some implementations of the command design pattern include parts for supporting undo and redo actions. In order to do that a mechanism to obtain past states of the Receiver object is needed. In order to achieve this there are two options:</p>

<ol>
  <li>
    <p>Before running each command a snapshot of the receiver stat is stored in memory/ This does not require much programing effort but can not be always applied. For example doing this in a image processing application whould require storing images in memory after aech step, which is partically impossible.</p>
  </li>
  <li>
    <p>Instead of storing receiver object stats, the set of performed operations are stored in memory. In this case the command and receiver classes should implement the liverse algorithms to undo each action. This will require additional programing effort, but less memory will be required. Sometimes for undo/redo actions the command should store more information about the state of the receiver objects. A good idea in such cases is to use the Memento Pattern.</p>
  </li>
</ol>

<h3 id="asynchronous-method-invocation">Asynchronous Method Invocation</h3>

<p>Another usage for the command design pattern is to run commands asynchronous in background of an application. In this case the invoker is running in the main thread and sends the requests to the receiver which is running in a separete therad. The invoker will keep a queue of commands to be run and will send them to the receiver while it finishes running them.</p>

<p>Instead of using one thread in which the receiver is running more threads can be created for this. But for performance issues(thread creation is consuming) the number of threads should be limited. In this case the invoker will use a pool of receiver threads to run command asynchronously.</p>

<h3 id="adding-new-commands">Adding new commands</h3>

<p>The command object decouples the object that invokes the action from the object that performs the action.
There are implementations of the pattern in which the invoker instantitates the concrete command objects. In this case if we need to add a new command type we need to change the invoker as well. And this would violate the Open Close Principle. In order to have the ability to add new commands with minimum of effort we have to make sure that the invoker is aware only about the abstract command class or interface.</p>

<h3 id="using-composite-commands">Using composite commands</h3>

<p>When adding new commands to the application we can use the composite pattern to grous existing commands in another new command. This way, macros can be created from exisiting commands.</p>

<h2 id="hot-spot">Hot spot</h2>

<p>The main advantage of the command design pattern is that it decouples the object that invokes the operation from the one that know how to perform it. And this advantage must be kept. There are implementations of this design pattern in which the invoker is aware of the concrete commands classes. This is wrong making the implementation more tightly coupled. The invoker should be aware only about the abstract command class.</p>
:ET